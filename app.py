import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# ================================
# ูุฑุงุกุฉ ุงูุจูุงูุงุช
# ================================
@st.cache_data
def load_data():
    try:
        return pd.read_csv("dailysales.csv", encoding="utf-8-sig")
    except:
        return pd.read_csv("dailysales.csv", encoding="latin1")

df = load_data()

# ================================
# ุงูุนููุงู ุงูุฑุฆูุณู
# ================================
st.set_page_config(page_title="ููุญุฉ ูุชุงุจุนุฉ ุงููุจูุนุงุช", layout="wide")
st.title("๐ ููุญุฉ ูุชุงุจุนุฉ ุงููุจูุนุงุช")
st.markdown("ุชูุฑูุฑ ุชูุงุนูู ูุนุฑุถ ุฃุฏุงุก ุงูููุงุฏูุจ ูุชุญููู ุงูุฃูุฏุงู")

# ================================
# ููุฎุต ุณุฑูุน
# ================================
col1, col2, col3, col4 = st.columns(4)
col1.metric("ุฅุฌูุงูู ุงููุจูุนุงุช", f"{df['ุตุงูู ุงููุจูุนุงุช'].sum():,.0f}")
col2.metric("ุฅุฌูุงูู ุนุฏุฏ ุงูุนููุงุก", df["ุงุชุตุงูุงุช ุงูุนููุงุก"].sum())
col3.metric("ุฅุฌูุงูู ุชุญููู ุงููุฏู ูุจูุนุงุช", f"{df['ุชุญููู ุงููุฏู ุงููุจูุนุงุช'].mean():.2f}")
col4.metric("ุฅุฌูุงูู ุชุญููู ุงููุฏู ุงุชุตุงูุงุช", f"{df['ุชุญููู ุงููุฏู ุงูุงุชุตุงูุงุช'].mean():.2f}")

# ================================
# ุฌุฏูู ุงูุจูุงูุงุช
# ================================
st.subheader("๐ ุจูุงูุงุช ุชูุตูููุฉ")
st.dataframe(df, use_container_width=True)

# ================================
# ุฑุณู ุจูุงูู: ุงููุจูุนุงุช ุญุณุจ ุงูููุฏูุจ
# ================================
st.subheader("๐ ุงููุจูุนุงุช ุญุณุจ ุงูููุฏูุจ")
fig, ax = plt.subplots(figsize=(10, 5))
df.groupby("ุงุณู ุงูููุฏูุจ")["ุตุงูู ุงููุจูุนุงุช"].sum().plot(kind="bar", ax=ax, color="skyblue")
ax.set_ylabel("ุฅุฌูุงูู ุงููุจูุนุงุช")
ax.set_xlabel("ุงูููุฏูุจ")
st.pyplot(fig)

# ================================
# ุฑุณู ุจูุงูู: ุชุญููู ุงููุฏู
# ================================
st.subheader("๐ฏ ูุณุจุฉ ุชุญููู ุงูุฃูุฏุงู (ูุจูุนุงุช)")
fig2, ax2 = plt.subplots(figsize=(10, 5))
df.plot(
    kind="bar",
    x="ุงุณู ุงูููุฏูุจ",
    y="ุชุญููู ุงููุฏู ุงููุจูุนุงุช",
    ax=ax2,
    color="green",
    legend=False
)
ax2.set_ylabel("ุชุญููู ุงููุฏู")
st.pyplot(fig2)

# ================================
# ููุชุฑุฉ ุจูุงูุงุช
# ================================
st.subheader("๐ ููุชุฑุฉ")
names = st.multiselect("ุงุฎุชุฑ ุงูููุงุฏูุจ", options=df["ุงุณู ุงูููุฏูุจ"].unique(), default=df["ุงุณู ุงูููุฏูุจ"].unique())
filtered_df = df[df["ุงุณู ุงูููุฏูุจ"].isin(names)]
st.dataframe(filtered_df, use_container_width=True)
